<?xml version="1.0"?>

<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:c="http://java.sun.com/jstl/core"
      xmlns:onc="http://jboss.org/on/component"
      xmlns:onf="http://jboss.org/on/function"
      xmlns:rich="http://richfaces.ajax4jsf.org/rich">

<ui:composition template="/rhq/resource/layout/main.xhtml">

<ui:param name="pageTitle" value="View Content for Resource '#{ResourceUIBean.name}'"/>
<ui:param name="selectedTabName" value="Content.History"/>

<ui:define name="metaHeaders">
    <meta http-equiv="Refresh" content="10"/>
</ui:define>

<ui:define name="content">

<!-- Content Requests Table -->

<h:form id="contentaRequestsForm">
<input type="hidden" name="id" value="${param.id}"/>

<rich:panel>
    <f:facet name="header"><h:outputText value="Currently Executing Requests"/></f:facet>

    <i><h:outputText value="There are no currently executing content requests"
                     rendered="#{ListInProgressContentRequestsUIBean.dataModel.rowCount eq 0}"/></i>

    <rich:dataTable rendered="#{ListInProgressContentRequestsUIBean.dataModel.rowCount gt 0}"
                    id="contentInProgressRequestsDataTable"
                    rows="#{PageControl.ContentInProgressRequestsList.pageSize}"
                    value="#{ListInProgressContentRequestsUIBean.dataModel}"
                    var="item"
                    width="100%"
                    columnsWidth="16%, 17%, 16%, 16%, 16%, 16%"
                    headerClass="tableRowHeader"
                    footerClass="on-pager-footer"
                    onRowMouseOver="this.style.backgroundColor='#E7E7E7'"
                    onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'">

        <f:facet name="PageControlView">
            <onc:paginationControl id="ContentInProgressRequestsList"/>
        </f:facet>

        <rich:column rendered="#{param.debug}">
            <f:facet name="header">
                <onc:sortableColumnHeader sort="csr.id">
                    <h:outputText styleClass="headerText" value="ID"/>
                </onc:sortableColumnHeader>
            </f:facet>

            <h:outputText value="#{item.id}"/>
        </rich:column>

        <rich:column>
            <f:facet name="header">
                <onc:sortableColumnHeader sort="csr.ctime">
                    <h:outputText styleClass="headerText" value="Request Started"/>
                </onc:sortableColumnHeader>
            </f:facet>

            <h:outputText value="#{item.createdDate}"/>
        </rich:column>

        <rich:column>
            <f:facet name="header">
                <onc:sortableColumnHeader sort="csr.notes">
                    <h:outputText styleClass="headerText" value="Notes"/>
                </onc:sortableColumnHeader>
            </f:facet>

            <h:outputText value="#{item.notes}"/>
        </rich:column>

        <rich:column>
            <f:facet name="header">
                <onc:sortableColumnHeader sort="csr.status">
                    <h:outputText styleClass="headerText" value="Request Status"/>
                </onc:sortableColumnHeader>
            </f:facet>

            <h:outputText value="#{item.status}"/>
        </rich:column>

        <rich:column>
            <f:facet name="header">
                <onc:sortableColumnHeader sort="csr.contentRequestType">
                    <h:outputText styleClass="headerText" value="Request Type"/>
                </onc:sortableColumnHeader>
            </f:facet>

            <h:outputText value="#{item.contentRequestType}"/>
        </rich:column>

        <rich:column>
            <f:facet name="header">
                <h:outputText styleClass="headerText" value="Details"/>
            </f:facet>

           <h:commandLink style="margin-top: 10px;" value="VIEW"
                          action="showContentServiceRequestDetails">
               <f:param name="selectedRequestId" value="#{item.id}"/>
           </h:commandLink>
            
        </rich:column>

        <rich:column>
            <f:facet name="header">
                <onc:sortableColumnHeader sort="csr.subjectName">
                    <h:outputText styleClass="headerText" value="User"/>
                </onc:sortableColumnHeader>
            </f:facet>

            <h:outputText value="#{item.subjectName}"/>
        </rich:column>

        <f:facet name="footer">
            <rich:columnGroup>
                <rich:column colspan="6" width="100%">
                    <ui:param name="paginationDataTableName" value="contentInProgressRequestsDataTable"/>
                    <ui:param name="paginationDataModel" value="#{ListInProgressContentRequestsUIBean.dataModel}"/>
                    <ui:param name="paginationPageControl" value="#{PageControl.ContentInProgressRequestsList}"/>
                    <ui:include src="../include/pagination.xhtml"/>
                </rich:column>
            </rich:columnGroup>
        </f:facet>


    </rich:dataTable>

</rich:panel>

<rich:panel>
    <f:facet name="header"><h:outputText value="Completed Requests"/></f:facet>

    <i><h:outputText value="There are no completed content requests"
                     rendered="#{ListCompletedContentRequestsUIBean.dataModel.rowCount eq 0}"/></i>


        <rich:dataTable rendered="#{ListCompletedContentRequestsUIBean.dataModel.rowCount gt 0}"
                    binding="#{ListCompletedContentRequestsUIBean.dataTable}"
                    id="contentCompletedRequestsDataTable"
                    rows="#{PageControl.ContentCompletedRequestsList.pageSize}"
                    value="#{ListCompletedContentRequestsUIBean.dataModel}"
                    var="item"
                    width="100%"
                    columnsWidth="16%, 17%, 16%, 16%, 16%, 16%"
                    headerClass="tableRowHeader"
                    footerClass="on-pager-footer"
                    onRowMouseOver="this.style.backgroundColor='#E7E7E7'"
                    onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'">

        <f:facet name="PageControlView">
            <onc:paginationControl id="ContentCompletedRequestsList"/>
        </f:facet>

        <rich:column rendered="#{param.debug}">
            <f:facet name="header">
                <onc:sortableColumnHeader sort="csr.id">
                    <h:outputText styleClass="headerText" value="ID"/>
                </onc:sortableColumnHeader>
            </f:facet>

            <h:outputText value="#{item.id}"/>
        </rich:column>

        <rich:column>
            <f:facet name="header">
                <onc:sortableColumnHeader sort="csr.ctime">
                    <h:outputText styleClass="headerText" value="Request Started"/>
                </onc:sortableColumnHeader>
            </f:facet>

            <h:outputText value="#{item.createdDate}"/>
        </rich:column>

        <rich:column>
            <f:facet name="header">
                <onc:sortableColumnHeader sort="csr.notes">
                    <h:outputText styleClass="headerText" value="Notes"/>
                </onc:sortableColumnHeader>
            </f:facet>

            <h:outputText value="#{item.notes}"/>
        </rich:column>
           
        <rich:column>
            <f:facet name="header">
                <onc:sortableColumnHeader sort="csr.status">
                    <h:outputText styleClass="headerText" value="Request Status"/>
                </onc:sortableColumnHeader>
            </f:facet>

            <h:outputText value="#{item.status}"/>
        </rich:column>

        <rich:column>
            <f:facet name="header">
                <onc:sortableColumnHeader sort="csr.contentRequestType">
                    <h:outputText styleClass="headerText" value="Request Type"/>
                </onc:sortableColumnHeader>
            </f:facet>

            <h:outputText value="#{item.contentRequestType}"/>
        </rich:column>

        <rich:column>
            <f:facet name="header">
                <h:outputText styleClass="headerText" value="Details"/>
            </f:facet>

            <h:commandLink style="margin-top: 10px;" value="VIEW"
                           action="showContentServiceRequestDetails">
                <f:param name="selectedRequestId" value="#{item.id}"/>
            </h:commandLink>

        </rich:column>

        <rich:column>
            <f:facet name="header">
                <onc:sortableColumnHeader sort="csr.subjectName">
                    <h:outputText styleClass="headerText" value="User"/>
                </onc:sortableColumnHeader>
            </f:facet>

            <h:outputText value="#{item.subjectName}"/>
        </rich:column>

        <f:facet name="footer">
            <rich:columnGroup>
                <rich:column colspan="6" width="100%">
                    <ui:param name="paginationDataTableName" value="contentCompletedRequestsDataTable"/>
                    <ui:param name="paginationDataModel" value="#{ListCompletedContentRequestsUIBean.dataModel}"/>
                    <ui:param name="paginationPageControl" value="#{PageControl.ContentCompletedRequestsList}"/>
                    <ui:include src="../include/pagination.xhtml"/>
                </rich:column>
            </rich:columnGroup>
        </f:facet>


    </rich:dataTable>


</rich:panel>

<rich:panel>
    <f:facet name="header"><h:outputText value="Full Package Audit Trail"/></f:facet>

    <p>The following is a complete listing of all of the package operations that have occurred on this resource.
    By default, they are ordered from newest to oldest. In other words, for packages that are referenced more than
    one time in this list, the most recent item indicates the current status of the package.</p>

    <i><h:outputText value="There are no package related events on this resource"
                     rendered="#{AuditTrailUIBean.dataModel.rowCount eq 0}"/></i>


        <rich:dataTable rendered="#{AuditTrailUIBean.dataModel.rowCount gt 0}"
                    binding="#{AuditTrailUIBean.dataTable}"
                    id="auditTrailDataTable"
                    rows="#{PageControl.AuditTrailList.pageSize}"
                    value="#{AuditTrailUIBean.dataModel}"
                    var="item"
                    width="100%"
                    columnsWidth="20%, 20%, 20%, 10%, 20%, 10%"
                    headerClass="tableRowHeader"
                    footerClass="on-pager-footer"
                    onRowMouseOver="this.style.backgroundColor='#E7E7E7'"
                    onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'">

        <f:facet name="PageControlView">
            <onc:paginationControl id="AuditTrailList"/>
        </f:facet>

        <rich:column>
           <f:facet name="header">
              <onc:sortableColumnHeader sort="iph.packageVersion.displayName">
                 <h:outputText styleClass="headerText" value="Package Name" />
              </onc:sortableColumnHeader>
           </f:facet>

           <h:outputText value="#{item.packageVersion.displayName}" rendered="#{!empty item.packageVersion.displayName}"/>
           <h:outputText value="#{item.packageVersion.generalPackage.name}" rendered="#{empty item.packageVersion.displayName}"/>
        </rich:column>

        <rich:column>
           <f:facet name="header">
              <onc:sortableColumnHeader sort="iph.packageVersion.displayVersion">
                 <h:outputText styleClass="headerText" value="Version" />
              </onc:sortableColumnHeader>
           </f:facet>

           <h:outputText value="#{item.packageVersion.displayVersion}"/>
        </rich:column>

        <rich:column>
           <f:facet name="header">
              <onc:sortableColumnHeader sort="iph.packageVersion.architecture">
                 <h:outputText styleClass="headerText" value="Architecture" />
              </onc:sortableColumnHeader>
           </f:facet>

           <h:outputText value="#{item.packageVersion.architecture.name}"/>
        </rich:column>

        <rich:column>
           <f:facet name="header">
              <onc:sortableColumnHeader sort="iph.status.displayName">
                 <h:outputText styleClass="headerText" value="Status" />
              </onc:sortableColumnHeader>
           </f:facet>

           <h:outputText value="#{item.status.displayName}"/>
        </rich:column>

        <rich:column>
           <f:facet name="header">
              <onc:sortableColumnHeader sort="iph.timestamp">
                 <h:outputText styleClass="headerText" value="Timestamp" />
              </onc:sortableColumnHeader>
           </f:facet>

           <h:outputText value="#{item.timestamp}">
               <f:converter converterId="UserDateTimeConverter" />
           </h:outputText>
        </rich:column>

        <rich:column>
           <f:facet name="header">
              <h:outputText styleClass="headerText" value="Details" />
           </f:facet>

           <h:commandLink style="margin-top: 10px;" value="VIEW"
                          action="showHistoryItem">
               <f:param name="selectedHistoryId" value="#{item.id}"/>
           </h:commandLink>

        </rich:column>

        <f:facet name="footer">
            <rich:columnGroup>
                <rich:column colspan="6" width="100%">
                    <ui:param name="paginationDataTableName" value="auditTrailDataTable"/>
                    <ui:param name="paginationDataModel" value="#{AuditTrailUIBean.dataModel}"/>
                    <ui:param name="paginationPageControl" value="#{PageControl.AuditTrailList}"/>
                    <ui:include src="../include/pagination.xhtml"/>
                </rich:column>
            </rich:columnGroup>
        </f:facet>


    </rich:dataTable>


</rich:panel>

</h:form>

</ui:define>
</ui:composition>

</html>
